openapi: 3.0.0
info:
  title: Product Listing API
  version: 1.0.2
  description: API documentation for the Product Listing backend (Auth, Products, Orders, Cart)
servers:
  - url: http://localhost:4000
paths:
  /api/auth/register:
    post:
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
      responses:
        '201':
          description: Created
  /api/auth/login:
    post:
      summary: Login and receive JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
  /api/products:
    get:
      summary: List products (search, filter, pagination)
      parameters:
        - in: query
          name: q
          schema:
            type: string
        - in: query
          name: category
          schema:
            type: string
        - in: query
          name: minPrice
          schema:
            type: number
        - in: query
          name: maxPrice
          schema:
            type: number
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
      responses:
        '200':
          description: OK
    post:
      summary: Create a product (requires auth)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '201':
          description: Created
  /api/products/{id}:
    get:
      summary: Get product detail
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
    put:
      summary: Update product (requires auth)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Updated
    delete:
      summary: Delete product (requires auth)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted
  /api/cart:
    get:
      summary: Get current user's cart
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cart retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartResponse'
    post:
      summary: Add an item to cart or increment quantity
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartItemInput'
      responses:
        '200':
          description: Updated cart
    put:
      summary: Update an item quantity in cart
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartItemInput'
      responses:
        '200':
          description: Updated cart
  /api/cart/{productId}:
    delete:
      summary: Remove a product from cart
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: productId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Updated cart
  /api/cart/checkout:
    post:
      summary: Create an order from the user's cart (checkout)
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Order created
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ProductCreate:
      type: object
      required: [name, price]
      properties:
        name:
          type: string
        description:
          type: string
        price:
          type: number
        category:
          type: string
        imageUrl:
          type: string
    OrderCreate:
      type: object
      properties:
        items:
          type: array
          items:
            type: object
            properties:
              product:
                type: string
              quantity:
                type: integer
    OrderItem:
      type: object
      properties:
        product:
          $ref: '#/components/schemas/ProductCreate'
        quantity:
          type: integer
        price:
          type: number
    OrderResponse:
      type: object
      properties:
        _id:
          type: string
        user:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        total:
          type: number
    CartItemInput:
      type: object
      required: [product]
      properties:
        product:
          type: string
        quantity:
          type: integer
    CartItem:
      type: object
      properties:
        product:
          type: object
          description: Populated product object
        quantity:
          type: integer
    CartResponse:
      type: object
      properties:
        cart:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'
